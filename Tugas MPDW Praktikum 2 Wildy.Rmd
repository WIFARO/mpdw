---
title: "Tugas Praktikum 2 Wildy MPDW"
output: html_document
date: "2025-09-02"
---

```{r}
library(rio)
```


```{r}
dt <- import("https://raw.githubusercontent.com/nyayunabila/mpdw/refs/heads/main/Pertemuan%202/Data%20IPM%20Semarang%20(new).xlsx")
dt
```
```{r}
#Plot s
plot(dt$x, dt$y, type="b", col="blue", pch=19, xlab="Tahun", ylab="IPM", main="Plot IPM Semarang")
```
```{r}
dt.ts <- ts(dt$y)
summary(dt.ts)
ts.plot(dt.ts, main="Time Series IPM Semarang", ylab="IPM", xlab="Tahun")
points(dt.ts, col="red", pch=19)
```


```{r}
model = lm(y ~ x, data = dt)
summary(model)

library(lmtest)
dwtest(model)

acf(model$residuals, main="ACF Residuals Regresi IPM Semarang")

plot(model$residuals, type="b", main="Plot Residuals Regresi IPM Semarang", ylab="Residuals", xlab="Order")
abline(h=0, lty=2)
```
P-value kecil, tolak H0. Berarti ada auto-korelasi pada model

### Penanganan

#### Metode 1 (CO)

```{r}
model_co <- cochrane.orcutt(reg)
summary(model_co)

rho <- model_co$rho
cat(" Rho optimum:", rho)
```

Perhitungan Manual

```{r}
ipm_trans <- dt$y[-1] - dt$y[-10]*rho

tahun_trans <- dt$x[-1] - dt$x[-10]*rho
model_co_manual <- lm(ipm_trans~tahun_trans)

b0_co_manual <- coef(model_co_manual)[1]/(1-rho)
b1_co_manual <- coef(model_co_manual)[2]
cat("Koefisien manual Cochrane-Orcutt:\n")
cat("b0:", b0_co_manual, "\n")
cat("b1:", b1_co_manual, "\n")
```

#### Metode 2 (HL)

```{r}
hildreth.lu.func<- function(r, model){
  x <- model.matrix(model)[,-1]
  y <- model.response(model.frame(model))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

#Pencariab rho yang meminimumkan SSE
r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model))}))
round(tab, 4)
```

```{r}
rOpt <- seq(0.2,0.5, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model))}))
head(tabOpt[order(tabOpt$SSE),])
```

rho dengan SSE terkecil di 0.353

```{r}
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
text(x=0.353, y=0.3759558, labels = "rho=0.353", cex = 0.8)
```

```{r}
model_hl <- hildreth.lu(dt$y, dt$x, rho = 0.353)
summary(model_hl)
```

```{r}
cat("y = ", coef(model_hl)[1]/(1-0.793), "+", coef(model_hl)[2],"x", sep = "")
```

```{r}
dwtest(model_hl)
```

Setelah dilakukan penanganan menggunakan Hildreth-Lu, dan dilakukan uji Durbin-Watson ulang. Didapat p-value > 0,05. Yang artinya kita gagal menolak H0, dan itu berarti data kami setelah penanganan tidak terdapat autokorelasi.

### Hasil penanganan (H-L)

```{r}
sse_awal <- sum(residuals(model)^2)
sse_co <- sum(residuals(model_co)^2)
sse_hl <- sum(residuals(model_hl)^2)

data.frame(
  Metode = c("Model Awal (Sakit)", "Cochrane-Orcutt (Sehat)", "Hildreth-Lu (Sehat)"),
  SSE = c(sse_awal, sse_co, sse_hl),
  DW_Statistic = c(dwtest(model)$statistic, model_co$DW[3], dwtest(model_hl)$statistic)
)
```

### Kesimpulan Investigasi

- Baik metode Cochrane-Orcutt maupun Hildreth-Lu berhasil menurunkan SSE model, artinya model yang baru lebih akurat.

- Keduanya juga berhasil menghilangkan autokorelasi, yang ditunjukkan oleh statistik D-W yang mendekati 2.







