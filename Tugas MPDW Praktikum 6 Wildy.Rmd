---
title: "MPDW Pertemuan 6"
author: "Wildy Fahmi Rosyidi G1401231066"
date: "2025-10-01"
output: html_document
---

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
library(rio)
library(forecast)
library(TSA)
library(TTR)
library(aTSA)
library(graphics)
```

## Input Data

```{r}
data_mpdw <- import("https://raw.githubusercontent.com/nyayunabila/mpdw/refs/heads/main/data%20kelompok%209%20-%20Sheet1.csv")
head(data_mpdw)
```

```{r}
data_301to400 <- data_mpdw[301:400, ]
data_301to400
```

## Plot Time Series

```{r}
data_301to400$daily_revenue <- gsub(",", ".", data_301to400$daily_revenue)

data_301to400$daily_revenue <- as.numeric(data_301to400$daily_revenue)

data_pertemuan5 <- ts(data_301to400$daily_revenue)

ts.plot(data_pertemuan5, 
        xlab="Time", 
        ylab="Daily Revenue", 
        main="Time Series Plot",
        lwd=2)
points(data_pertemuan5)
```
### Data Latih

```{r}
data5_train<-data_301to400[1:80, ]
train.ts<-ts(data5_train$daily_revenue)
plot.ts(train.ts, lty=1, xlab="waktu", ylab="Daily Revenue", main="Plot Data Latih")
```

### Data Uji

```{r}
data5_test<-data_301to400[81:100, ]
test.ts<-ts(data5_test$daily_revenue)
plot.ts(test.ts, lty=1, xlab="waktu", ylab="Daily Revenue", main="Plot Data Latih")
```

```{r}
lattice::densityplot(as.vector(train.ts))
```

Dari grafik diatas terlihat masih terdapat beberapa pencilan pada data.

## Uji Stasioner Dalam Rataan dan Ragam

### ACF

```{r}
acf(train.ts)
```

### Uji ADF

```{r}
tseries::adf.test(train.ts)
```

Karena p-value < 0,05 menandakan bahwa data sudah stasioner dalam rataan.

### Plot Box-Cox

Bila ingin membuat plot box-cox pastikan variabel y nya tidak ada yang 0. Maka akan dicek apakah ada variabel y yang bernilai 0.

```{r}
any(data5_train$daily_revenue == 0)
```

Ternyata ada data yang bernilai 0. Agar data tidak ada yang berniali 0 maka akan dijumlahkan dengan 1.

```{r}
train_ts_geser <- train.ts + 1
```

```{r}
train_ts_geser
```


```{r}
index <- seq(1:80)
bc = boxcox(train_ts_geser ~ index, lambda = seq(-1,4,by=0.01))

lambda <- bc$x[which.max(bc$y)]
lambda

bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Dari hasil plot diatas, dalam rentang tidak termasuk nilai lambda = 1. Berarti data tidak stasioner dalam ragam. Dan didapatkan nilai lambda optimum nya `0.61`dengan batas bawahnya `0.42` dan batas atasnya `0.82`

### Transformasi Box-cox

Karena lambda optimum nya mendekati nilai `0,5` maka akan dilakukan transformasi akar terhadap daily revenue

```{r}
data_boxcox <- train_ts_geser^0.5
```

```{r}
index <- seq(1:80)

bc2 <- boxcox(
  data_boxcox ~ index,
  lambda = seq(0, 5, by = 0.001)
)

lambda <- bc2$x[which.max(bc2$y)]
lambda

ci_lambda <- bc2$x[bc2$y > max(bc2$y) - 0.5 * qchisq(0.95, 1)]

ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```

Setelah dilakukan transformasi box-cox terlihat bahwa data sudah stasioner dalam ragam.

### Pengecekan Ulang

Untuk memastikan, akan dilakukan pengujian ulang kestasioneran dalam rataan terhadap model yang sudah transformasi 

#### ACF

```{r}
acf(data_boxcox)
```

#### Uji ADF

```{r}
tseries::adf.test(data_boxcox)
```

Karena p-value < 0.05. Maka data setelah transformasi sudah stasioner dalam rataan dan juga dalam ragam.

## Identifikasi Model

### Plot ACF

```{r}
acf(data_boxcox)
```

ACF cenderung tails-off

### Plot PACF

```{r}
pacf(data_boxcox)
```

PACF nya juga cenderung tails-off

### Plot EACF

```{r}
eacf(data_boxcox)
```

Dari eacf diatas didapatkan beberapa model, seperti ARIMA(0,0,0), ARIMA(1,0,1), ARIMA(2,0,2), dan ARIMA(3,0,3)

## Pendugaan Parameter Model

### ARIMA(0,0,0)

```{r}
model1.da=Arima(data_boxcox, order=c(0,0,0),method="ML")
summary(model1.da)
lmtest::coeftest(model1.da)
```

### ARIMA(1,0,1)

```{r}
model2.da=Arima(data_boxcox, order=c(1,0,1),method="ML")
summary(model2.da)
lmtest::coeftest(model2.da)
```

### ARIMA(2,0,2)

```{r}
model3.da=Arima(data_boxcox, order=c(2,0,2),method="ML")
summary(model3.da)
lmtest::coeftest(model3.da)
```

### ARIMA(3,0,3)

```{r}
model4.da=Arima(data_boxcox, order=c(3,0,3),method="ML")
summary(model4.da)
lmtest::coeftest(model4.da)
```

Bila membandingkan dari AIC ketiga model diatas, didapat model ARIMA(0,0,0) memiliki nilai AIC terkecil. Jadi model tersebut yang akan saya gunakan.

## Analisis Sisaan

### Eksplorasi Sisaan

```{r}
sisaan.da <- model1.da$residuals 
par(mfrow=c(2,2)) 
qqnorm(sisaan.da) 
qqline(sisaan.da, col = "blue", lwd = 2) 
plot(c(1:length(sisaan.da)),sisaan.da) 
acf(sisaan.da) 
pacf(sisaan.da) 
par(mfrow = c(1,1))
```

### Uji Formal

```{r}
ks.test(sisaan.da,"pnorm")
```

p-value < 0.05. Maka kita menolak H0, artinya sisaan tidak menyebar secara normal 

```{r}
Box.test(sisaan.da, type = "Ljung")
```

karena p-value > 0.05. Maka kita gagal menolak H0, yang berarti sisaan saling bebas

```{r}
Box.test((sisaan.da)^2, type = "Ljung")
```

Karena p-value > 0.05. Maka kita gagal menolak H0, yang berarti ragam sisaan homogen

```{r}
t.test(sisaan.da, mu = 0, conf.level = 0.95)
```

Karena p-value > 0.05. Maka kita gagal menolak H0, yang berarti nilai tengah sama dengan 0

## Peramalan

Dilakukan peramalan untuk 20 hari kedepan

```{r}
ramalan.da <- forecast::forecast(model1.da, h = 20) 
ramalan.da
data.ramalan.da <- ramalan.da$mean
plot(ramalan.da)
```

```{r}
pt_1 <- train.ts[80]
hasil.forc.Diff <- data.ramalan.da
hasil <- diffinv(hasil.forc.Diff, differences = 1) + pt_1
ts.plot(train.ts,hasil)
```

```{r}
perbandingan.da<-matrix(data=c(head(test.ts, n=20), hasil[-1]),
                     nrow = 30, ncol = 2)
colnames(perbandingan.da)<-c("Aktual","Hasil Forecast")
perbandingan.da
accuracy(ts(hasil[-1]), head(test.ts, n=20))
```





















